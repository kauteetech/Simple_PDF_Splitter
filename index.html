<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Simple PDF Splitter</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path fill='%234b7bff' d='M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z'/><path fill='%23ffffff' d='M8,12V14H16V12H8M8,16V18H13V16H8Z'/></svg>" />
    <style>
      :root {
        --bg: #0f1113;
        --surface: #15181b;
        --text: #e7e9ee;
        --muted: #a9b0bb;
        --border: #2a2f36;
        --primary: #4b7bff;
        --primary-contrast: #ffffff;
        --ok: #2ecc71;
        --warn: #f1c40f;
        --error: #ff4d4f;
        --focus: #8ab4ff;
        --radius: 12px;
        --shadow: 0 6px 24px rgba(0,0,0,0.35);
        --font: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      }

      :root.light {
        --bg: #f6f7f9;
        --surface: #ffffff;
        --text: #1a1c1f;
        --muted: #4b5563;
        --border: #e3e5ea;
        --shadow: 0 6px 24px rgba(0,0,0,0.08);
      }

      * { box-sizing: border-box; }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font: 14px/1.5 var(--font);
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 20px;
        border-bottom: 1px solid var(--border);
        background: var(--surface);
        box-shadow: var(--shadow);
      }

      .brand { display: flex; align-items: center; gap: 10px; }
      .title { font-size: 18px; margin: 0; }

      .main { 
        padding: 20px; 
        max-width: 1200px; 
        margin: 0 auto;
      }

      .section {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: var(--shadow);
      }

      .section h3 {
        margin: 0 0 16px 0;
        font-size: 16px;
        color: var(--text);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        border-radius: 8px;
        padding: 8px 16px;
        cursor: pointer;
        font-size: 14px;
        text-decoration: none;
        transition: all 0.2s ease;
      }
      .btn.primary {
        background: var(--primary);
        border-color: var(--primary);
        color: var(--primary-contrast);
      }
      .btn.success {
        background: var(--ok);
        border-color: var(--ok);
        color: var(--primary-contrast);
      }
      .btn:disabled { opacity: 0.5; cursor: not-allowed; }
      .btn:hover:not(:disabled) { opacity: 0.9; transform: translateY(-1px); }

      .upload-area {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 60px 20px;
        text-align: center;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .upload-area:hover { 
        border-color: var(--primary); 
        background: rgba(75, 123, 255, 0.03);
      }
      .upload-area.dragover { 
        border-color: var(--primary); 
        background: rgba(75, 123, 255, 0.08); 
        transform: scale(1.02);
      }

      .file-input { display: none; }

      .pdf-info {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 16px;
        margin: 20px 0;
        padding: 16px;
        background: var(--bg);
        border-radius: 8px;
      }

      .info-item {
        text-align: center;
      }

      .info-value {
        font-size: 24px;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 4px;
      }

      .info-label {
        font-size: 12px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .split-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 20px 0;
      }

      @media (max-width: 768px) {
        .split-options {
          grid-template-columns: 1fr;
        }
      }

      .option-card {
        border: 2px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }

      .option-card:hover {
        border-color: var(--primary);
        background: rgba(75, 123, 255, 0.05);
      }

      .option-card.selected {
        border-color: var(--primary);
        background: rgba(75, 123, 255, 0.1);
      }

      .option-card .option-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text);
      }

      .option-card .option-desc {
        font-size: 14px;
        color: var(--muted);
        margin-bottom: 16px;
      }

      .option-controls {
        display: none;
      }

      .option-card.selected .option-controls {
        display: block;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        color: var(--text);
        font-size: 14px;
      }

      .form-input, .form-select {
        width: 100%;
        background: var(--bg);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 10px 12px;
        font-size: 14px;
      }

      .form-input:focus, .form-select:focus {
        outline: 2px solid var(--focus);
        outline-offset: -2px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .pages-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 12px;
        margin: 20px 0;
        max-height: 400px;
        overflow-y: auto;
        padding: 8px;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: var(--bg);
      }

      .page-card {
        border: 2px solid var(--border);
        border-radius: 8px;
        padding: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s ease;
        background: var(--surface);
      }

      .page-card:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
      }

      .page-card.selected {
        border-color: var(--primary);
        background: rgba(75, 123, 255, 0.1);
      }

      .page-thumbnail {
        width: 100%;
        height: 140px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 4px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--muted);
        font-size: 12px;
        overflow: hidden;
      }

      .page-thumbnail canvas {
        max-width: 100%;
        max-height: 100%;
        border-radius: 2px;
      }

      .page-number {
        font-size: 12px;
        font-weight: 600;
        color: var(--text);
      }

      .selection-info {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 12px;
        margin: 12px 0;
        font-size: 14px;
      }

      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .status { 
        padding: 12px; 
        margin: 10px 0; 
        border-radius: 6px; 
        background: rgba(75, 123, 255, 0.1);
        border: 1px solid rgba(75, 123, 255, 0.2);
        font-size: 14px;
      }

      .progress {
        width: 100%;
        height: 8px;
        background: var(--border);
        border-radius: 4px;
        overflow: hidden;
        margin: 10px 0;
      }
      .progress-bar {
        height: 100%;
        background: var(--primary);
        width: 0%;
        transition: width 0.3s ease;
      }

      .theme-btn {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
        padding: 8px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 8px 0;
      }

      .range-display {
        font-family: monospace;
        background: var(--bg);
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid var(--border);
        margin-top: 8px;
        font-size: 12px;
      }

      .quick-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 12px 0;
      }

      .quick-btn {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: 4px;
        padding: 4px 8px;
        font-size: 12px;
        cursor: pointer;
      }

      .quick-btn:hover {
        background: var(--primary);
        color: var(--primary-contrast);
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--muted);
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="brand">
        <h1 class="title">📄 Simple PDF Splitter </h1>
      </div>
      <button class="theme-btn" onclick="toggleTheme()" title="Toggle theme">🌓</button>
    </header>

    <main class="main">
      <!-- Upload Section -->
      <div class="section">
        <h3>📤 Upload PDF</h3>
        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
          <div>
            <strong>Click to select a PDF file</strong><br>
            or drag and drop it here
          </div>
          <div style="margin-top: 8px; color: var(--muted); font-size: 12px;">
            Maximum file size: 100 MB
          </div>
        </div>

        <input type="file" id="fileInput" class="file-input" accept=".pdf,application/pdf">
        
        <div id="pdfInfo" style="display: none;">
          <div class="pdf-info">
            <div class="info-item">
              <div class="info-value" id="fileName">-</div>
              <div class="info-label">File Name</div>
            </div>
            <div class="info-item">
              <div class="info-value" id="fileSize">-</div>
              <div class="info-label">File Size</div>
            </div>
            <div class="info-item">
              <div class="info-value" id="pageCount">-</div>
              <div class="info-label">Total Pages</div>
            </div>
          </div>
          
          <div class="controls">
            <button class="btn" onclick="clearFile()">📄 Clear File</button>
            <button class="btn primary" onclick="loadPdfPages()" id="loadPagesBtn">
              🔍 Load Page Previews
            </button>
          </div>
        </div>
      </div>

      <!-- Split Options -->
      <div class="section" id="splitSection" style="display: none;">
        <h3>⚙️ Split Options</h3>
        
        <div class="split-options">
          <div class="option-card" id="allPagesOption" onclick="selectOption('allPages')">
            <div class="option-title">📑 Split All Pages</div>
            <div class="option-desc">Extract each page as a separate PDF file</div>
            <div class="option-controls">
              <div class="checkbox-group">
                <input type="checkbox" id="addPageNumbers" checked>
                <label for="addPageNumbers">Add page numbers to filenames</label>
              </div>
            </div>
          </div>
          
          <div class="option-card" id="customRangeOption" onclick="selectOption('customRange')">
            <div class="option-title">🎯 Custom Page Ranges</div>
            <div class="option-desc">Select specific pages or page ranges to extract</div>
            <div class="option-controls">
              <div class="form-group">
                <label class="form-label">Page Ranges (e.g., 1-3, 5, 7-9)</label>
                <input type="text" id="pageRanges" class="form-input" 
                       placeholder="1-3, 5, 7-9" onkeyup="parsePageRanges()">
                <div class="range-display" id="rangeDisplay">Enter page ranges above</div>
              </div>
              
              <div class="quick-actions">
                <button class="quick-btn" onclick="selectOddPages()">Odd Pages</button>
                <button class="quick-btn" onclick="selectEvenPages()">Even Pages</button>
                <button class="quick-btn" onclick="selectFirstHalf()">First Half</button>
                <button class="quick-btn" onclick="selectSecondHalf()">Second Half</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Page Selection -->
      <div class="section" id="pageSelection" style="display: none;">
        <h3>📋 Page Selection</h3>
        
        <div class="selection-info" id="selectionInfo">
          Select pages below or use the quick actions
        </div>
        
        <div class="quick-actions">
          <button class="quick-btn" onclick="selectAllPages()">Select All</button>
          <button class="quick-btn" onclick="clearSelection()">Clear Selection</button>
          <button class="quick-btn" onclick="toggleSelection()">Invert Selection</button>
        </div>
        
        <div class="pages-grid" id="pagesGrid">
          <div class="empty-state">
            Click "Load Page Previews" to see page thumbnails
          </div>
        </div>
      </div>

      <!-- Process Section -->
      <div class="section" id="processSection" style="display: none;">
        <h3>🚀 Process & Download</h3>
        
        <div class="form-group">
          <label class="form-label">Output Filename Prefix</label>
          <input type="text" id="filenamePrefix" class="form-input" 
                 placeholder="document" value="split">
        </div>
        
        <div class="controls">
          <button class="btn success" id="splitBtn" onclick="splitPdf()" disabled>
            🔄 Split PDF
          </button>
          <button class="btn" onclick="resetAll()">🔄 Start Over</button>
        </div>

        <div id="status" class="status" style="display: none;"></div>
        <div class="progress" style="display: none;">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>
    </main>

    <script>
      // Global variables
      let currentPdf = null;
      let pdfDocument = null;
      let pdfPages = [];
      let selectedPages = new Set();
      let splitOption = 'allPages';
      let pdfLibLoaded = false;
      let pdfjsLoaded = false;

      // Theme toggle
      function toggleTheme() {
        document.documentElement.classList.toggle('light');
      }

      // Format bytes
      function formatBytes(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
      }

      // Show status
      function showStatus(message, type = 'info') {
        const status = document.getElementById('status');
        status.textContent = message;
        status.style.display = 'block';
        
        // Remove previous type classes
        status.className = 'status';
        if (type === 'error') {
          status.style.background = 'rgba(255, 77, 79, 0.1)';
          status.style.borderColor = 'rgba(255, 77, 79, 0.2)';
        } else if (type === 'success') {
          status.style.background = 'rgba(46, 204, 113, 0.1)';
          status.style.borderColor = 'rgba(46, 204, 113, 0.2)';
        } else {
          status.style.background = 'rgba(75, 123, 255, 0.1)';
          status.style.borderColor = 'rgba(75, 123, 255, 0.2)';
        }
        
        console.log('Status:', message);
      }

      // Handle file selection
      function handleFile(file) {
        if (!file) return;
        
        // Validate file type
        if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
          showStatus('Please select a PDF file only.', 'error');
          return;
        }
        
        // Validate file size (100 MB limit)
        if (file.size > 100 * 1024 * 1024) {
          showStatus('File too large! Maximum size is 100 MB.', 'error');
          return;
        }
        
        currentPdf = file;
        
        // Update UI
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileSize').textContent = formatBytes(file.size);
        document.getElementById('pdfInfo').style.display = 'block';
        
        // Load PDF to get page count
        loadPdfInfo();
        
        showStatus(`PDF loaded: ${file.name} (${formatBytes(file.size)})`);
      }

      // Load PDF info
      async function loadPdfInfo() {
        try {
          await loadPdfJs();
          
          const arrayBuffer = await currentPdf.arrayBuffer();
          const loadingTask = pdfjsLib.getDocument(arrayBuffer);
          pdfDocument = await loadingTask.promise;
          
          document.getElementById('pageCount').textContent = pdfDocument.numPages;
          document.getElementById('splitSection').style.display = 'block';
          
          // Initialize filename prefix
          const baseName = currentPdf.name.replace(/\.pdf$/i, '');
          document.getElementById('filenamePrefix').value = baseName;
          
        } catch (error) {
          console.error('Error loading PDF:', error);
          showStatus('Error loading PDF. Please try a different file.', 'error');
        }
      }

      // Load PDF pages for preview
      async function loadPdfPages() {
        if (!pdfDocument) return;
        
        try {
          showStatus('Loading page previews...');
          document.getElementById('loadPagesBtn').disabled = true;
          
          const pagesGrid = document.getElementById('pagesGrid');
          pagesGrid.innerHTML = '';
          pdfPages = [];
          
          for (let pageNum = 1; pageNum <= pdfDocument.numPages; pageNum++) {
            const page = await pdfDocument.getPage(pageNum);
            pdfPages.push(page);
            
            // Create page card
            const pageCard = document.createElement('div');
            pageCard.className = 'page-card';
            pageCard.onclick = () => togglePageSelection(pageNum);
            
            const thumbnail = document.createElement('div');
            thumbnail.className = 'page-thumbnail';
            thumbnail.textContent = 'Loading...';
            
            const pageNumber = document.createElement('div');
            pageNumber.className = 'page-number';
            pageNumber.textContent = `Page ${pageNum}`;
            
            pageCard.appendChild(thumbnail);
            pageCard.appendChild(pageNumber);
            pagesGrid.appendChild(pageCard);
            
            // Render thumbnail
            renderPageThumbnail(page, thumbnail);
          }
          
          document.getElementById('pageSelection').style.display = 'block';
          document.getElementById('processSection').style.display = 'block';
          
          showStatus(`Loaded ${pdfDocument.numPages} pages`, 'success');
          
        } catch (error) {
          console.error('Error loading pages:', error);
          showStatus('Error loading page previews.', 'error');
        } finally {
          document.getElementById('loadPagesBtn').disabled = false;
        }
      }

      // Render page thumbnail
      async function renderPageThumbnail(page, container) {
        try {
          const scale = 0.3;
          const viewport = page.getViewport({ scale });
          
          const canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;
          
          const renderContext = {
            canvasContext: context,
            viewport: viewport
          };
          
          await page.render(renderContext).promise;
          
          container.innerHTML = '';
          container.appendChild(canvas);
          
        } catch (error) {
          console.error('Error rendering thumbnail:', error);
          container.textContent = 'Preview error';
        }
      }

      // Select split option
      function selectOption(option) {
        // Clear previous selection
        document.querySelectorAll('.option-card').forEach(card => {
          card.classList.remove('selected');
        });
        
        // Select new option
        document.getElementById(option + 'Option').classList.add('selected');
        splitOption = option;
        
        updateSplitButton();
      }

      // Toggle page selection
      function togglePageSelection(pageNum) {
        if (selectedPages.has(pageNum)) {
          selectedPages.delete(pageNum);
        } else {
          selectedPages.add(pageNum);
        }
        
        // Update visual selection
        const pageCards = document.querySelectorAll('.page-card');
        pageCards[pageNum - 1].classList.toggle('selected', selectedPages.has(pageNum));
        
        updateSelectionInfo();
        updateSplitButton();
      }

      // Update selection info
      function updateSelectionInfo() {
        const info = document.getElementById('selectionInfo');
        if (selectedPages.size === 0) {
          info.textContent = 'No pages selected';
        } else {
          const pages = Array.from(selectedPages).sort((a, b) => a - b);
          info.textContent = `Selected pages: ${pages.join(', ')} (${pages.length} total)`;
        }
      }

      // Update split button state
      function updateSplitButton() {
        const splitBtn = document.getElementById('splitBtn');
        
        if (splitOption === 'allPages') {
          splitBtn.disabled = !pdfDocument;
        } else {
          splitBtn.disabled = selectedPages.size === 0;
        }
      }

      // Parse page ranges
      function parsePageRanges() {
        const input = document.getElementById('pageRanges').value;
        const display = document.getElementById('rangeDisplay');
        
        if (!input.trim()) {
          display.textContent = 'Enter page ranges above';
          return;
        }
        
        try {
          const pages = parseRangeString(input, pdfDocument ? pdfDocument.numPages : 100);
          display.textContent = `Pages: ${pages.join(', ')} (${pages.length} total)`;
          
          // Update selected pages
          selectedPages.clear();
          pages.forEach(page => selectedPages.add(page));
          
          // Update visual selection
          document.querySelectorAll('.page-card').forEach((card, index) => {
            card.classList.toggle('selected', selectedPages.has(index + 1));
          });
          
          updateSelectionInfo();
          updateSplitButton();
          
        } catch (error) {
          display.textContent = `Error: ${error.message}`;
        }
      }

      // Parse range string (e.g., "1-3, 5, 7-9")
      function parseRangeString(rangeStr, maxPage) {
        const pages = new Set();
        const ranges = rangeStr.split(',').map(r => r.trim());
        
        for (const range of ranges) {
          if (range.includes('-')) {
            const [start, end] = range.split('-').map(n => parseInt(n.trim()));
            if (isNaN(start) || isNaN(end) || start < 1 || end > maxPage || start > end) {
              throw new Error(`Invalid range: ${range}`);
            }
            for (let i = start; i <= end; i++) {
              pages.add(i);
            }
          } else {
            const page = parseInt(range);
            if (isNaN(page) || page < 1 || page > maxPage) {
              throw new Error(`Invalid page: ${range}`);
            }
            pages.add(page);
          }
        }
        
        return Array.from(pages).sort((a, b) => a - b);
      }

      // Quick selection functions
      function selectAllPages() {
        if (!pdfDocument) return;
        
        selectedPages.clear();
        for (let i = 1; i <= pdfDocument.numPages; i++) {
          selectedPages.add(i);
        }
        
        document.querySelectorAll('.page-card').forEach(card => {
          card.classList.add('selected');
        });
        
        updateSelectionInfo();
        updateSplitButton();
      }

      function clearSelection() {
        selectedPages.clear();
        document.querySelectorAll('.page-card').forEach(card => {
          card.classList.remove('selected');
        });
        updateSelectionInfo();
        updateSplitButton();
      }

      function toggleSelection() {
        if (!pdfDocument) return;
        
        for (let i = 1; i <= pdfDocument.numPages; i++) {
          if (selectedPages.has(i)) {
            selectedPages.delete(i);
          } else {
            selectedPages.add(i);
          }
        }
        
        document.querySelectorAll('.page-card').forEach((card, index) => {
          card.classList.toggle('selected', selectedPages.has(index + 1));
        });
        
        updateSelectionInfo();
        updateSplitButton();
      }

      function selectOddPages() {
        if (!pdfDocument) return;
        
        selectedPages.clear();
        for (let i = 1; i <= pdfDocument.numPages; i += 2) {
          selectedPages.add(i);
        }
        updatePageSelection();
      }

      function selectEvenPages() {
        if (!pdfDocument) return;
        
        selectedPages.clear();
        for (let i = 2; i <= pdfDocument.numPages; i += 2) {
          selectedPages.add(i);
        }
        updatePageSelection();
      }

      function selectFirstHalf() {
        if (!pdfDocument) return;
        
        selectedPages.clear();
        const midpoint = Math.ceil(pdfDocument.numPages / 2);
        for (let i = 1; i <= midpoint; i++) {
          selectedPages.add(i);
        }
        updatePageSelection();
      }

      function selectSecondHalf() {
        if (!pdfDocument) return;
        
        selectedPages.clear();
        const midpoint = Math.ceil(pdfDocument.numPages / 2) + 1;
        for (let i = midpoint; i <= pdfDocument.numPages; i++) {
          selectedPages.add(i);
        }
        updatePageSelection();
      }

      function updatePageSelection() {
        document.querySelectorAll('.page-card').forEach((card, index) => {
          card.classList.toggle('selected', selectedPages.has(index + 1));
        });
        updateSelectionInfo();
        updateSplitButton();
      }

      // Clear file
      function clearFile() {
        currentPdf = null;
        pdfDocument = null;
        pdfPages = [];
        selectedPages.clear();
        
        document.getElementById('pdfInfo').style.display = 'none';
        document.getElementById('splitSection').style.display = 'none';
        document.getElementById('pageSelection').style.display = 'none';
        document.getElementById('processSection').style.display = 'none';
        
        showStatus('Ready to upload a new PDF file');
      }

      // Reset all
      function resetAll() {
        clearFile();
        document.getElementById('fileInput').value = '';
      }

      // Load PDF.js library
      async function loadPdfJs() {
        if (pdfjsLoaded) return;
        
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
          script.onload = () => {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            pdfjsLoaded = true;
            resolve();
          };
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // Load PDF-lib for splitting
      async function loadPdfLib() {
        if (pdfLibLoaded) return;
        
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js';
          script.onload = () => {
            pdfLibLoaded = true;
            resolve();
          };
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // Load JSZip for creating ZIP files
      async function loadJSZip() {
        if (window.JSZip) return;
        
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // Split PDF
      async function splitPdf() {
        if (!currentPdf || !pdfDocument) return;
        
        try {
          // Load required libraries
          showStatus('Loading PDF processing libraries...');
          await Promise.all([loadPdfLib(), loadJSZip()]);
          
          const splitBtn = document.getElementById('splitBtn');
          const progressBar = document.getElementById('progressBar');
          const progress = progressBar.parentElement;
          
          splitBtn.disabled = true;
          progress.style.display = 'block';
          progressBar.style.width = '0%';
          
          showStatus('Loading PDF document...');
          
          // Load PDF with pdf-lib
          const arrayBuffer = await currentPdf.arrayBuffer();
          const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
          
          let pagesToSplit = [];
          
          if (splitOption === 'allPages') {
            // Split all pages
            for (let i = 1; i <= pdfDocument.numPages; i++) {
              pagesToSplit.push(i);
            }
          } else {
            // Use selected pages
            pagesToSplit = Array.from(selectedPages).sort((a, b) => a - b);
          }
          
          if (pagesToSplit.length === 0) {
            throw new Error('No pages selected for splitting');
          }
          
          showStatus(`Splitting ${pagesToSplit.length} pages...`);
          
          const zip = new JSZip();
          const prefix = document.getElementById('filenamePrefix').value || 'split';
          const addPageNumbers = document.getElementById('addPageNumbers').checked;
          
          for (let i = 0; i < pagesToSplit.length; i++) {
            const pageNum = pagesToSplit[i];
            const pageIndex = pageNum - 1; // pdf-lib uses 0-based indexing
            
            showStatus(`Processing page ${pageNum} (${i + 1}/${pagesToSplit.length})...`);
            
            // Create new PDF with single page
            const newPdf = await PDFLib.PDFDocument.create();
            const [copiedPage] = await newPdf.copyPages(pdfDoc, [pageIndex]);
            newPdf.addPage(copiedPage);
            
            // Generate PDF bytes
            const pdfBytes = await newPdf.save();
            
            // Generate filename
            let filename;
            if (splitOption === 'allPages' && addPageNumbers) {
              filename = `${prefix}_page_${pageNum.toString().padStart(3, '0')}.pdf`;
            } else {
              filename = `${prefix}_page_${pageNum}.pdf`;
            }
            
            // Add to ZIP
            zip.file(filename, pdfBytes);
            
            // Update progress
            const percent = ((i + 1) / pagesToSplit.length) * 90;
            progressBar.style.width = percent + '%';
          }
          
          showStatus('Creating ZIP file...');
          progressBar.style.width = '95%';
          
          // Generate ZIP
          const zipBlob = await zip.generateAsync({ type: 'blob' });
          
          // Download ZIP
          const zipFilename = `${prefix}_split_${pagesToSplit.length}_pages.zip`;
          downloadBlob(zipBlob, zipFilename);
          
          progressBar.style.width = '100%';
          showStatus(`✅ Split complete! Downloaded ${pagesToSplit.length} pages as ${zipFilename}`, 'success');
          
        } catch (error) {
          console.error('Split failed:', error);
          showStatus(`❌ Split failed: ${error.message}`, 'error');
        } finally {
          document.getElementById('splitBtn').disabled = false;
          setTimeout(() => {
            document.querySelector('.progress').style.display = 'none';
          }, 3000);
        }
      }

      // Download blob as file
      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Set up drag and drop
      const uploadArea = document.getElementById('uploadArea');
      
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });
      
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleFile(files[0]);
        }
      });

      // Set up file input
      document.getElementById('fileInput').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
          handleFile(e.target.files[0]);
        }
      });

      // Initialize
      selectOption('allPages');
      showStatus('Ready to split PDF files! Upload a PDF to get started.');
    </script>
  </body>
</html>
